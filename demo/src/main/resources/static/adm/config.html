<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Configurações do Bar</title>
    <link rel="stylesheet" href="../css/styleLogin.css">
    <style>
        .card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            margin: auto;
            margin-top: 20px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
        }
        .btn-login {
            padding: 8px 16px;
            margin-top: 10px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .btn-login:hover {
            background: #0056b3;
        }
        small { color: gray; }
    </style>
</head>
<body>

<h1 style="text-align:center;">Configurações do Bar</h1>
<button class="btn-login" onclick="history.back()">⬅ Voltar</button>

<div class="card">
    <label>Preço do Couvert por pessoa:</label>
    <input id="precoCouvert" type="number" step="0.01" placeholder="Ex: 5.00">
    <small>Deixe vazio para não alterar</small>

    <label>Gorjeta Bebidas (%):</label>
    <input id="gorjetaBebida" type="number" step="0.01" placeholder="Ex: 10">
    <small>Deixe vazio para não alterar</small>

    <label>Gorjeta Comidas (%):</label>
    <input id="gorjetaComida" type="number" step="0.01" placeholder="Ex: 10">
    <small>Deixe vazio para não alterar</small>

    <button class="btn-login" onclick="salvarConfiguracoes()">Salvar</button>
</div>

<script>
    const API = "http://localhost:8080/api/configuracoes";

    let configuracoesAtuais = {};

    // Carrega as configurações do banco
    async function carregarConfiguracoes() {
        const resp = await fetch(API);
        const config = await resp.json();
        configuracoesAtuais = config;

        document.getElementById("precoCouvert").value = config.precoCouvert;
        document.getElementById("gorjetaBebida").value = config.gorjetaBebida * 100;
        document.getElementById("gorjetaComida").value = config.gorjetaComida * 100;
    }

    // Salva as configurações, atualizando apenas campos preenchidos
    async function salvarConfiguracoes() {
        const novoConfig = {};

        const preco = document.getElementById("precoCouvert").value;
        const gorjetaBebida = document.getElementById("gorjetaBebida").value;
        const gorjetaComida = document.getElementById("gorjetaComida").value;

        // Atualiza apenas se o campo foi preenchido
        novoConfig.precoCouvert = preco !== "" ? parseFloat(preco) : null;
        novoConfig.gorjetaBebida = gorjetaBebida !== "" ? parseFloat(gorjetaBebida) / 100 : null;
        novoConfig.gorjetaComida = gorjetaComida !== "" ? parseFloat(gorjetaComida) / 100 : null;


        // Envia PUT para atualizar
        const resp = await fetch(API, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(novoConfig)
        });

        if(resp.ok) {
            alert("Configurações salvas com sucesso!");
            carregarConfiguracoes();
        } else {
            alert("Erro ao salvar as configurações!");
        }
    }

    window.onload = carregarConfiguracoes;
</script>

</body>
</html>
